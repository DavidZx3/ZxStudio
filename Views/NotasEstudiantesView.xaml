<UserControl 
    x:Class="ZxStudio.Views.NotasEstudiantesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    mc:Ignorable="d" 
    d:DesignHeight="700" 
    d:DesignWidth="1000"
    Background="{StaticResource AppLightBackground}">

    <Grid Margin="40">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="400"/>
            <ColumnDefinition Width="20"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ========================================= -->
        <!-- COLUMNA IZQUIERDA: LISTA DE ESTUDIANTES -->
        <!-- ========================================= -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Título -->
            <TextBlock 
                Grid.Row="0"
                Text="Estudiantes"
                FontSize="24"
                FontWeight="Bold"
                Foreground="{StaticResource AppPrimaryBrush}"
                Margin="0,0,0,20"/>

            <!-- Búsqueda -->
            <Border 
                Grid.Row="1"
                Background="White"
                BorderBrush="#DDDDDD"
                BorderThickness="1"
                CornerRadius="8"
                Padding="12"
                Margin="0,0,0,15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Icono de Lupa -->
                    <Path 
                        Grid.Column="0"
                        Data="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"
                        Fill="#999999"
                        Width="20"
                        Height="20"
                        Stretch="Uniform"
                        VerticalAlignment="Center"
                        Margin="0,0,10,0"/>

                    <!-- TextBox de Búsqueda -->
                    <TextBox 
                        x:Name="BusquedaEstudianteTextBox"
                        Grid.Column="1"
                        BorderThickness="0"
                        Background="Transparent"
                        VerticalContentAlignment="Center"
                        FontSize="14"
                        Text="Buscar estudiante..."/>
                </Grid>
            </Border>

            <!-- Filtros -->
            <StackPanel Grid.Row="2" Margin="0,0,0,15">
                <TextBlock 
                    Text="Filtrar por:"
                    FontSize="12"
                    FontWeight="SemiBold"
                    Foreground="#666666"
                    Margin="0,0,0,10"/>

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="10"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Filtro Grado -->
                    <ComboBox 
                        x:Name="GradoComboBox"
                        Grid.Column="0"
                        Height="35"
                        Background="White"
                        BorderBrush="#DDDDDD"
                        BorderThickness="1"
                        Padding="10"
                        FontSize="13"
                        SelectedIndex="0">
                        <ComboBoxItem Content="Todos los Grados"/>
                        <ComboBoxItem Content="1° Grado"/>
                        <ComboBoxItem Content="2° Grado"/>
                        <ComboBoxItem Content="3° Grado"/>
                        <ComboBoxItem Content="4° Grado"/>
                        <ComboBoxItem Content="5° Grado"/>
                        <ComboBoxItem Content="6° Grado"/>
                    </ComboBox>

                    <!-- Filtro Sección -->
                    <ComboBox 
                        x:Name="SeccionComboBox"
                        Grid.Column="2"
                        Height="35"
                        Background="White"
                        BorderBrush="#DDDDDD"
                        BorderThickness="1"
                        Padding="10"
                        FontSize="13"
                        SelectedIndex="0">
                        <ComboBoxItem Content="Todas las Secciones"/>
                        <ComboBoxItem Content="Sección A"/>
                        <ComboBoxItem Content="Sección B"/>
                        <ComboBoxItem Content="Sección C"/>
                    </ComboBox>
                </Grid>
            </StackPanel>

            <!-- Lista de Estudiantes -->
            <Border 
                Grid.Row="3"
                Background="White"
                BorderBrush="#DDDDDD"
                BorderThickness="1"
                CornerRadius="8">

                <ListBox 
                    x:Name="EstudiantesListBox"
                    BorderThickness="0"
                    Background="Transparent"
                    ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                    SelectionChanged="EstudiantesListBox_SelectionChanged">

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border 
                                Background="Transparent"
                                Padding="15,12"
                                BorderBrush="#F0F0F0"
                                BorderThickness="0,0,0,1">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="50"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Avatar -->
                                    <Border 
                                        Grid.Column="0"
                                        Width="40"
                                        Height="40"
                                        Background="{StaticResource AppPrimaryBrush}"
                                        CornerRadius="20">
                                        <TextBlock 
                                            Text="{Binding Iniciales}"
                                            Foreground="White"
                                            FontSize="16"
                                            FontWeight="Bold"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                                    </Border>

                                    <!-- Información -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0">
                                        <TextBlock 
                                            Text="{Binding Nombre}"
                                            FontSize="14"
                                            FontWeight="SemiBold"
                                            Foreground="{StaticResource AppDarkTextBrush}"/>
                                        <TextBlock 
                                            FontSize="12"
                                            Foreground="#999999">
                                            <Run Text="{Binding Grado, Mode=OneWay}"/>
                                            <Run Text=" - "/>
                                            <Run Text="{Binding Seccion, Mode=OneWay}"/>
                                        </TextBlock>
                                    </StackPanel>

                                    <!-- ID -->
                                    <TextBlock 
                                        Grid.Column="2"
                                        Text="{Binding Id}"
                                        FontSize="12"
                                        FontWeight="SemiBold"
                                        Foreground="#999999"
                                        VerticalAlignment="Center"/>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>

                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#E3F2FD"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#F5F5F5"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
            </Border>
        </Grid>

        <!-- ========================================= -->
        <!-- COLUMNA DERECHA: NOTAS DEL ESTUDIANTE -->
        <!-- ========================================= -->
        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Información del Estudiante Seleccionado -->
            <Border 
                Grid.Row="0"
                Background="White"
                BorderBrush="#DDDDDD"
                BorderThickness="1"
                CornerRadius="8"
                Padding="25"
                Margin="0,0,0,20">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Avatar Grande -->
                    <Border 
                        Grid.Column="0"
                        Width="70"
                        Height="70"
                        Background="{StaticResource AppPrimaryBrush}"
                        CornerRadius="35"
                        Margin="0,0,20,0">
                        <TextBlock 
                            x:Name="EstudianteIniciales"
                            Text="--"
                            Foreground="White"
                            FontSize="28"
                            FontWeight="Bold"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"/>
                    </Border>

                    <!-- Información -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock 
                            x:Name="EstudianteNombre"
                            Text="Selecciona un estudiante"
                            FontSize="20"
                            FontWeight="Bold"
                            Foreground="{StaticResource AppDarkTextBrush}"
                            Margin="0,0,0,5"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock 
                                x:Name="EstudianteGrado"
                                Text="--"
                                FontSize="14"
                                Foreground="#666666"
                                Margin="0,0,10,0"/>
                            <TextBlock 
                                Text="•"
                                FontSize="14"
                                Foreground="#666666"
                                Margin="0,0,10,0"/>
                            <TextBlock 
                                x:Name="EstudianteId"
                                Text="ID: --"
                                FontSize="14"
                                Foreground="#666666"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Promedio -->
                    <Border 
                        Grid.Column="2"
                        Background="#E8F5E9"
                        CornerRadius="8"
                        Padding="20,10"
                        VerticalAlignment="Center">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock 
                                Text="Promedio"
                                FontSize="12"
                                Foreground="#666666"
                                HorizontalAlignment="Center"
                                Margin="0,0,0,5"/>
                            <TextBlock 
                                x:Name="EstudiantePromedio"
                                Text="--"
                                FontSize="32"
                                FontWeight="Bold"
                                Foreground="#4CAF50"
                                HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <!-- Título de Notas -->
            <TextBlock 
                Grid.Row="1"
                Text="Calificaciones por Materia"
                FontSize="18"
                FontWeight="SemiBold"
                Foreground="{StaticResource AppDarkTextBrush}"
                Margin="0,0,0,15"/>

            <!-- Tabla de Notas por Materia -->
            <Border 
                Grid.Row="2"
                Background="White"
                BorderBrush="#DDDDDD"
                BorderThickness="1"
                CornerRadius="8">

                <DataGrid 
                    x:Name="NotasDataGrid"
                    AutoGenerateColumns="False"
                    CanUserAddRows="False"
                    CanUserDeleteRows="False"
                    HeadersVisibility="Column"
                    GridLinesVisibility="None"
                    AlternatingRowBackground="#F9F9F9"
                    RowBackground="White"
                    BorderThickness="0"
                    SelectionMode="Single"
                    RowHeight="55"
                    FontSize="14"
                    IsReadOnly="True">

                    <DataGrid.Resources>
                        <Style TargetType="DataGridColumnHeader">
                            <Setter Property="Background" Value="{StaticResource PrimaryAccentBrush}"/>
                            <Setter Property="Foreground" Value="White"/>
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="FontSize" Value="13"/>
                            <Setter Property="Padding" Value="20,12"/>
                            <Setter Property="BorderThickness" Value="0,0,1,0"/>
                            <Setter Property="BorderBrush" Value="#4A5560"/>
                        </Style>

                        <Style TargetType="DataGridCell">
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Padding" Value="20,0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="DataGridCell">
                                        <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                                            <ContentPresenter VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </DataGrid.Resources>

                    <DataGrid.Columns>
                        <!-- Materia -->
                        <DataGridTextColumn 
                            Header="Materia" 
                            Binding="{Binding Materia}" 
                            Width="*">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="Foreground" Value="{StaticResource AppDarkTextBrush}"/>
                                    <Setter Property="FontSize" Value="14"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Periodo 1 -->
                        <DataGridTextColumn 
                            Header="1er Periodo" 
                            Binding="{Binding Periodo1}" 
                            Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="FontSize" Value="15"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Periodo 2 -->
                        <DataGridTextColumn 
                            Header="2do Periodo" 
                            Binding="{Binding Periodo2}" 
                            Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="FontSize" Value="15"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Periodo 3 -->
                        <DataGridTextColumn 
                            Header="3er Periodo" 
                            Binding="{Binding Periodo3}" 
                            Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="FontSize" Value="15"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Promedio -->
                        <DataGridTextColumn 
                            Header="Promedio" 
                            Binding="{Binding Promedio}" 
                            Width="120">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="FontSize" Value="16"/>
                                    <Setter Property="Foreground" Value="#4CAF50"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>

                        <!-- Acciones -->
                        <DataGridTemplateColumn Header="Acciones" Width="100">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <Button 
                                        Width="32"
                                        Height="32"
                                        Background="{StaticResource AppPrimaryBrush}"
                                        BorderThickness="0"
                                        Cursor="Hand"
                                        HorizontalAlignment="Center"
                                        ToolTip="Editar Nota">
                                        <Button.Resources>
                                            <Style TargetType="Border">
                                                <Setter Property="CornerRadius" Value="4"/>
                                            </Style>
                                        </Button.Resources>
                                        <Path 
                                            Data="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"
                                            Fill="White"
                                            Width="14"
                                            Height="14"
                                            Stretch="Uniform"/>
                                    </Button>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!-- Botones de Acción -->
            <StackPanel 
                Grid.Row="3" 
                Orientation="Horizontal" 
                HorizontalAlignment="Right"
                Margin="0,20,0,0">

                <Button
                    Height="45"
                    Padding="20,0"
                    Content="IMPRIMIR BOLETA"
                    Background="White"
                    Foreground="{StaticResource AppPrimaryBrush}"
                    BorderBrush="{StaticResource AppPrimaryBrush}"
                    BorderThickness="2"
                    FontSize="14"
                    FontWeight="SemiBold"
                    Cursor="Hand"
                    Margin="0,0,15,0">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="6"/>
                        </Style>
                    </Button.Resources>
                </Button>

                <Button
                    Height="45"
                    Padding="20,0"
                    Content="+ AGREGAR NOTA"
                    Background="{StaticResource AppPrimaryBrush}"
                    Foreground="White"
                    FontSize="14"
                    FontWeight="SemiBold"
                    BorderThickness="0"
                    Cursor="Hand"
                    Click="AgregarNota_Click">
                    <Button.Resources>
                        <Style TargetType="Border">
                            <Setter Property="CornerRadius" Value="6"/>
                        </Style>
                    </Button.Resources>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>